<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2U主機設定</title>
<style>
:root{
  --bg:#6c6c6c; --card:#ffffff; --primary:#002b88; --primary-light:#3b82f6;
  --danger:#ef4444; --muted:#6b7280; --shadow:0 6px 18px rgba(15,23,42,0.08);
  --radius:12px; font-family:-apple-system, BlinkMacSystemFont,'Segoe UI', Roboto,'Noto Sans TC','Microsoft JhengHei',sans-serif;
}
html,body{ height:100%; margin:0; background:var(--bg); }
body{ padding:24px; display:flex; justify-content:center; }
.card{ width:100%; max-width:1400px; background:var(--card); border-radius:0; box-shadow:var(--shadow); overflow:hidden; display:flex; flex-direction:column; height:95vh; }
.header{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 20px; background:var(--primary); color:white; }
.title{ font-size:22px; font-weight:600; }
.search-row { display:flex; align-items:center; gap:12px; padding:12px 20px; background:#f9fafb; border-radius:8px; margin:0 16px 12px 16px; flex-wrap:nowrap; }
.search-row .form-group{ display:flex; align-items:center; gap:6px; white-space:nowrap; }
.search-row label{ font-size:14px; font-weight:500; color:var(--muted); line-height:28px; }
.search-row input[type=text], .search-row input[type=date], .search-row select{ height:28px; padding:2px 6px; border-radius:6px; border:1px solid #ccc; font-size:13px; background:#fff; }
.btn-search, .btn-add{ height:32px; padding:0 14px; border-radius:6px; background:var(--primary-light); color:#fff; border:none; cursor:pointer; font-weight:600; font-size:14px; display:flex; align-items:center; justify-content:center; }
#countText{ padding:8px 20px; color:var(--muted); display:flex; justify-content:space-between; align-items:center; font-size:14px; }
.list-wrapper{ flex:1; overflow-y:auto; position:relative; }
.list{ width:100%; border-top:1px solid #eee; border-bottom:1px solid #eee; margin-top:0; }
.list-head{ display:flex; gap:12px; padding:10px 8px; align-items:center; color:var(--muted); font-weight:700; background:#f9fafb; position:sticky; top:0; z-index:2; }
.list-row{ display:flex; align-items:center; gap:12px; padding:12px 8px; border-bottom:1px solid #f2f2f2; }
.col-1{ width:60px; flex-shrink:0; text-align:center; color:var(--muted); }
.col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9{ flex:1; min-width:100px; }
.col-2{ flex:1.2; } .col-5{ flex:1.5; } .col-6{ flex:1.2; } .col-7,.col-8,.col-9{ flex:0.8; text-align:center; }
.empty { text-align:center; color:#6b7280; padding:20px 0; font-weight:500; }

/* 分頁樣式 */
.pagination{ display:flex; gap:4px; flex-wrap:wrap; }
.pagination span{ cursor:pointer; padding:3px 5px; color:var(--primary); font-weight:600; font-size:12px; }
.pagination span.current{ font-weight:700; text-decoration:underline; cursor:default; color:#111; }
.pagination span.disabled{ color:#999; cursor:default; }
.pagination-container{ display:flex; justify-content:center; padding:8px 0; }

#topBtn{ position:fixed; right:20px; bottom:20px; width:44px; height:44px; background:var(--primary-light); color:white; border:none; border-radius:8px; display:none; align-items:center; justify-content:center; cursor:pointer; z-index:200; }
#topBtn:hover{ background:#0056b3; }
.modal-bg{ position:fixed; inset:0; background:rgba(0,0,0,0.4); display:none; align-items:center; justify-content:center; z-index:300; }
.modal{ background:var(--card); border-radius:var(--radius); width:900px; max-width:95%; padding:0; box-shadow:var(--shadow); display:flex; flex-direction:column; overflow:hidden; }
.modal-header{ font-size:20px; font-weight:600; padding:16px 20px; background:var(--primary); color:#fff; }
.modal-body{ display:flex; flex-direction:column; gap:8px; max-height:70vh; overflow-y:auto; padding:16px 20px; background:#f9fafb; }
.modal-body .form-group{ display:flex; flex-direction:row; align-items:center; justify-content:flex-start; gap:8px; border:1px solid #ccc; border-radius:6px; padding:4px 8px; background:#f9f9f9; }
.modal-body .form-group label{ width:120px; font-weight:500; color:var(--muted); margin-bottom:0; white-space:nowrap; font-size:13px; }
.modal-body .form-group input, .modal-body .form-group select{ flex:1; height:28px; padding:2px 6px; border:1px solid #ccc; border-radius:6px; font-size:13px; background:#fff; }
.ip-group{ display:flex; gap:6px; flex:1; }
.ip-group input{ flex:1; }

.latlng-group{ display:flex; gap:6px; flex:1; }
.latlng-group input{ flex:1; }

.func-group{ display:flex; flex-direction:column; gap:8px; }
.func-block{ display:flex; gap:12px; flex-wrap:wrap; }
.func-block label{ display:flex; align-items:center; gap:4px; font-size:13px; }
.func-block input[type=checkbox]{ width:14px; height:14px; margin:0; }

.modal-footer{ display:flex; justify-content:flex-end; gap:10px; padding:12px 16px; background:#f3f4f6; border-top:1px solid #e5e7eb; }
.modal-footer .btn{ height:32px; padding:0 14px; border-radius:6px; border:none; cursor:pointer; font-weight:600; font-size:14px; display:flex; align-items:center; justify-content:center; }
.btn-cancel{ background:#ccc; color:#fff; } .btn-confirm{ background:var(--primary-light); color:#fff; }
.btn-close{ height:32px; padding:0 16px; border-radius:6px; border:1px solid #ccc; background:#ffffff; color:#374151; font-weight:600; cursor:pointer; }
.icon-btn{ padding:6px 10px; border-radius:8px; border:1px solid rgba(0,0,0,0.1); background:#fff; cursor:pointer; font-weight:600; margin:2px; }

@media (max-width:720px){
  .list-head{ font-size:13px; } .col-2,.col-3,.col-4,.col-5,.col-6,.col-7,.col-8,.col-9{ min-width:80px; }
  .search-row{ gap:8px; } 
  .modal-body .form-group{ flex-direction:column; align-items:flex-start; }
  .modal-body .form-group label{ width:100%; margin-bottom:4px; } 
  .ip-group{ flex-direction:column; }
  .latlng-group{ flex-direction:column; }
}
</style>
</head>
<body>
<div class="card" id="mainCard">
  <div class="header">
    <div class="title">2U主機設定</div>
    <button class="btn-add" onclick="openModal()">＋ 新增2U主機</button>
  </div>
  <div class="search-row">
    <div class="form-group"><label>縣市</label><select id="citySelect"></select></div>
    <div class="form-group"><label>鄉鎮</label><select id="townSelect"><option value="-">全部</option></select></div>
    <div class="form-group"><label>ID</label><input type="text" id="idSearch" placeholder="輸入ID"></div>
    <div class="form-group"><label>案場名稱</label><input type="text" id="nameSearch" placeholder="輸入案場名稱"></div>
    <div class="form-group"><label>每頁筆數</label>
      <select id="pageSizeSelect" onchange="changePageSize()">
        <option value="25" selected>25筆</option>
        <option value="50" >50筆</option>
        <option value="75">75筆</option>
        <option value="100">100筆</option>
      </select>
    </div>
    <button class="btn-search" onclick="searchRecords()">搜尋</button>
  </div>
  <div id="countText">
    <span>共 0 筆資料</span>
    <span id="topPagination" class="pagination"></span>
  </div>
  <div class="list-wrapper">
    <div class="list">
      <div class="list-head">
        <div class="col-1">序號</div>
        <div class="col-2">ID</div>
        <div class="col-3">縣市</div>
        <div class="col-4">鄉鎮</div>
        <div class="col-5">案場名稱</div>
        <div class="col-6">IP</div>
        <div class="col-7">編輯</div>
        <div class="col-8">刪除</div>
        <div class="col-9">瀏覽</div>
      </div>
      <div id="rowsContainer"><div class="empty">載入中...</div></div>
    </div>
    <div id="bottomPagination" class="pagination-container pagination"></div>
  </div>
</div>
<button id="topBtn" onclick="scrollToTop()">TOP</button>

<!-- Modal -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <div class="modal-header">新增2U主機</div>
    <div class="modal-body">
      <div class="form-group"><label>ID</label><input id="modalId"></div>
      <div class="form-group"><label>案場名稱</label><input id="modalName"></div>
      <div class="form-group"><label>建置日期</label><input type="date" id="modalDate"></div>
      <div class="form-group"><label>震度門檻</label>
        <select id="modalThreshold"><option>-</option><option>1</option><option>2</option><option>3</option><option>4</option>
        <option>5弱</option><option>5強</option><option>6弱</option><option>6強</option><option>7</option></select>
      </div>
      <div class="form-group"><label>縣市(場址效應分區)</label>
        <select id="modalCity"></select>
        <select id="modalTown"><option value="-">全部</option></select>
      </div>
      <div class="form-group"><label>IP</label><div class="ip-group">
        <input id="modalIP1" placeholder="IP 1">
        <input id="modalIP2" placeholder="IP 2">
      </div></div>
      <div class="form-group"><label>地址</label><input id="modalAddr"></div>
      <div class="form-group"><label>電話</label><input id="modalPhone"></div>
      <div class="form-group"><label>經緯度</label>
        <div class="latlng-group">
          <input id="modalLat" placeholder="緯度">
          <input id="modalLng" placeholder="經度">
        </div>
      </div>

      <!-- 功能區塊 -->
      <div class="form-group"><label>功能</label>
        <div class="func-group">
          <div class="func-block">
            <label><input type="checkbox" name="modalFunc" value="TCP"> TCP</label>
            <label><input type="checkbox" name="modalFunc" value="中保防災"> 中保防災</label>
            <label><input type="checkbox" name="modalFunc" value="氣象署"> 氣象署</label>
          </div>
          <div class="func-block">
            <label><input type="checkbox" name="modalFunc" value="DIO1"> DIO1</label>
            <label><input type="checkbox" name="modalFunc" value="DIO2"> DIO2</label>
            <label><input type="checkbox" name="modalFunc" value="DIO3"> DIO3</label>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-close" onclick="closeModal()">取消</button>
      <button class="btn btn-confirm" onclick="confirmModal()">確認</button>
    </div>
  </div>
</div>

<script>
// ===== 縣市鄉鎮對照 =====
const cityTownMap = {
  "台北市":["中正區","大同區","中山區","松山區","大安區","萬華區","信義區","士林區","北投區","內湖區","南港區","文山區"],
  "新北市":["板橋區","新店區","中和區","永和區","新莊區","淡水區","樹林區","蘆洲區"],
  "高雄市":["左營區","苓雅區","鼓山區","三民區","前鎮區","楠梓區"]
};
const citySelect = document.getElementById('citySelect');
const townSelect = document.getElementById('townSelect');
const modalCity = document.getElementById('modalCity');
const modalTown = document.getElementById('modalTown');
function populateCityOptions(select){
  select.innerHTML='<option value="-">-</option>';
  for(const c of Object.keys(cityTownMap)){
    const opt=document.createElement('option'); opt.value=c; opt.textContent=c;
    select.appendChild(opt);
  }
}
function populateTownOptions(city, select){
  select.innerHTML='<option value="-">-</option>';
  if(cityTownMap[city]) for(const t of cityTownMap[city]){
    const opt=document.createElement('option'); opt.value=t; opt.textContent=t; select.appendChild(opt);
  }
}
citySelect.addEventListener('change',()=>populateTownOptions(citySelect.value,townSelect));
modalCity.addEventListener('change',()=>populateTownOptions(modalCity.value,modalTown));
populateCityOptions(citySelect); populateTownOptions('-',townSelect);
populateCityOptions(modalCity); populateTownOptions('-',modalTown);

// ===== 假資料 =====
let hosts = Array.from({length:50}, (_,i)=>({
  id:'2U'+String(i+1).padStart(3,'0'),
  name:'主機'+String(i+1),
  city:['台北市','新北市','高雄市'][i%3],
  town:cityTownMap[['台北市','新北市','高雄市'][i%3]][i%5],
  ip1:`192.168.1.${i+1}`,
  ip2:`192.168.2.${i+1}`,
  funcs:['TCP','中保防災']
}));
let filteredHosts = hosts.slice();
let currentPage = 1; let pageSize = 25;
const rowsContainer = document.getElementById('rowsContainer');

// ===== 渲染表格與分頁 =====
function render(list){
  const totalPages=Math.ceil(list.length/pageSize);
  if(currentPage>totalPages) currentPage=totalPages||1;
  const start=(currentPage-1)*pageSize;
  const pageData=list.slice(start,start+pageSize);
  rowsContainer.innerHTML='';
  if(pageData.length===0){ rowsContainer.innerHTML='<div class="empty">查無資料</div>'; }
  else{
    pageData.forEach((e,idx)=>{
      const row=document.createElement('div'); row.className='list-row';
      row.innerHTML=`
      <div class="col-1">${start+idx+1}</div>
      <div class="col-2">${e.id}</div>
      <div class="col-3">${e.city}</div>
      <div class="col-4">${e.town}</div>
      <div class="col-5">${e.name}</div>
      <div class="col-6">${e.ip1}<br>${e.ip2}</div>
      <div class="col-7"><button class="icon-btn" onclick="editHost('${e.id}')">編輯</button></div>
      <div class="col-8"><button class="icon-btn" onclick="deleteHost('${e.id}')">刪除</button></div>
      <div class="col-9"><button class="icon-btn" onclick="viewHost('${e.id}')">瀏覽</button></div>`;
      rowsContainer.appendChild(row);
    });
  }

  const createPageSpan=(text,disabled,clickFunc,current=false)=>{
    const span=document.createElement('span'); span.textContent=text;
    span.className=(disabled?'disabled':'') + (current?' current':'');
    if(!disabled&&!current) span.onclick=clickFunc;
    return span;
  };

  // 上方分頁
  const topPaginationEl=document.getElementById('topPagination'); topPaginationEl.innerHTML='';
  topPaginationEl.appendChild(createPageSpan('第一頁',currentPage===1,()=>{currentPage=1;render(filteredHosts);}));
  let startPage=Math.max(1,currentPage-2); let endPage=Math.min(totalPages,currentPage+2);
  if(startPage>1) topPaginationEl.appendChild(createPageSpan('...',true,null));
  for(let i=startPage;i<=endPage;i++){
    topPaginationEl.appendChild(createPageSpan(i, false, ()=>{ currentPage=i; render(filteredHosts); }, i===currentPage));
  }
  if(endPage<totalPages) topPaginationEl.appendChild(createPageSpan('...',true,null));
  topPaginationEl.appendChild(createPageSpan('最後一頁',currentPage===totalPages,()=>{currentPage=totalPages;render(filteredHosts);}));

  // 下方分頁
  const bottomPaginationEl=document.getElementById('bottomPagination'); 
  bottomPaginationEl.innerHTML='';
  bottomPaginationEl.appendChild(createPageSpan('上一頁',currentPage===1,()=>{currentPage--; render(filteredHosts);}));
  for(let i=startPage;i<=endPage;i++){
    bottomPaginationEl.appendChild(createPageSpan(i,false,()=>{currentPage=i; render(filteredHosts);}, i===currentPage));
  }
  bottomPaginationEl.appendChild(createPageSpan('下一頁',currentPage===totalPages,()=>{currentPage++; render(filteredHosts);}));
  document.querySelector('#countText span').textContent=`共 ${list.length} 筆資料`;
}

function searchRecords(){
  const id=document.getElementById('idSearch').value.trim();
  const name=document.getElementById('nameSearch').value.trim();
  const city=citySelect.value; const town=townSelect.value;
  filteredHosts=hosts.filter(h=>{
    return (id===''||h.id.includes(id)) &&
           (name===''||h.name.includes(name)) &&
           (city==='-'||h.city===city) &&
           (town==='-'||h.town===town);
  });
  currentPage=1; render(filteredHosts);
}
function changePageSize(){ pageSize=parseInt(document.getElementById('pageSizeSelect').value); currentPage=1; render(filteredHosts); }
render(filteredHosts);

function scrollToTop(){ document.querySelector('.list-wrapper').scrollTop=0; }

// ===== Modal 功能 =====
const modalBg=document.getElementById('modalBg');
let currentEditingHost=null;
const modalId=document.getElementById('modalId');
const modalName=document.getElementById('modalName');
const modalDate=document.getElementById('modalDate');
const modalThreshold=document.getElementById('modalThreshold');
const modalIP1=document.getElementById('modalIP1');
const modalIP2=document.getElementById('modalIP2');
const modalAddr=document.getElementById('modalAddr');
const modalPhone=document.getElementById('modalPhone');
const modalLat=document.getElementById('modalLat');
const modalLng=document.getElementById('modalLng');

function openModal(){
  modalBg.style.display='flex';
  if(!currentEditingHost){
    modalId.value=''; modalName.value=''; modalDate.value=''; modalThreshold.value='-';
    modalCity.value='-'; populateTownOptions('-',modalTown); modalTown.value='-';
    modalIP1.value=''; modalIP2.value=''; modalAddr.value=''; modalPhone.value=''; modalLat.value=''; modalLng.value='';
    document.querySelectorAll('input[name="modalFunc"]').forEach(cb=>cb.checked=false);
    document.querySelector('.modal-header').textContent='新增2U主機';
    Array.from(modalBg.querySelectorAll('input,select')).forEach(el=>el.disabled=false);
    document.querySelector('.btn-confirm').style.display='flex';
  }
}
function closeModal(){ modalBg.style.display='none'; currentEditingHost=null; }
function confirmModal(){
  if(currentEditingHost){
    currentEditingHost.id=modalId.value;
    currentEditingHost.name=modalName.value;
    currentEditingHost.date=modalDate.value;
    currentEditingHost.threshold=modalThreshold.value;
    currentEditingHost.city=modalCity.value; currentEditingHost.town=modalTown.value;
    currentEditingHost.ip1=modalIP1.value; currentEditingHost.ip2=modalIP2.value;
    currentEditingHost.addr=modalAddr.value; currentEditingHost.phone=modalPhone.value;
    currentEditingHost.latlng=`${modalLat.value},${modalLng.value}`;
    currentEditingHost.funcs=Array.from(document.querySelectorAll('input[name="modalFunc"]:checked')).map(cb=>cb.value);
  }else{
    hosts.push({
      id:modalId.value, name:modalName.value, date:modalDate.value, threshold:modalThreshold.value,
      city:modalCity.value, town:modalTown.value,
      ip1:modalIP1.value, ip2:modalIP2.value,
      addr:modalAddr.value, phone:modalPhone.value, latlng:`${modalLat.value},${modalLng.value}`,
      funcs:Array.from(document.querySelectorAll('input[name="modalFunc"]:checked')).map(cb=>cb.value)
    });
  }
  searchRecords(); closeModal();
}

function editHost(id){
  const host=hosts.find(h=>h.id===id); if(!host) return;
  currentEditingHost=host; openModal();
  document.querySelector('.modal-header').textContent='編輯2U主機';
  modalId.value=host.id; modalName.value=host.name; modalDate.value=host.date||''; modalThreshold.value=host.threshold||'-';
  modalCity.value=host.city; populateTownOptions(host.city,modalTown); modalTown.value=host.town;
  modalIP1.value=host.ip1; modalIP2.value=host.ip2; modalAddr.value=host.addr||''; modalPhone.value=host.phone||'';
  if(host.latlng){ const parts=host.latlng.split(','); modalLat.value=parts[0]; modalLng.value=parts[1]; } else { modalLat.value=''; modalLng.value=''; }
  document.querySelectorAll('input[name="modalFunc"]').forEach(cb=>cb.checked=host.funcs.includes(cb.value));
  Array.from(modalBg.querySelectorAll('input,select')).forEach(el=>el.disabled=false);
  document.querySelector('.btn-confirm').style.display='flex';
}
function viewHost(id){
  const host=hosts.find(h=>h.id===id); if(!host) return;
  currentEditingHost=null; openModal();
  document.querySelector('.modal-header').textContent='瀏覽2U主機';
  modalId.value=host.id; modalName.value=host.name; modalDate.value=host.date||''; modalThreshold.value=host.threshold||'-';
  modalCity.value=host.city; populateTownOptions(host.city,modalTown); modalTown.value=host.town;
  modalIP1.value=host.ip1; modalIP2.value=host.ip2; modalAddr.value=host.addr||''; modalPhone.value=host.phone||'';
  if(host.latlng){ const parts=host.latlng.split(','); modalLat.value=parts[0]; modalLng.value=parts[1]; } else { modalLat.value=''; modalLng.value=''; }
  document.querySelectorAll('input[name="modalFunc"]').forEach(cb=>cb.checked=host.funcs.includes(cb.value));
  Array.from(modalBg.querySelectorAll('input,select')).forEach(el=>el.disabled=true);
  document.querySelector('.btn-confirm').style.display='none';
}
function deleteHost(id){ if(confirm('確定刪除？')){ hosts=hosts.filter(h=>h.id!==id); searchRecords(); } }
</script>
</body>
</html>

