<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>事件紀錄</title>
<style>
:root{
  --bg:#6c6c6c;
  --card:#ffffff;
  --primary:#002b88;
  --primary-light:#3b82f6;
  --danger:#ef4444;
  --muted:#6b7280;
  --shadow:0 6px 18px rgba(15,23,42,0.08);
  --radius:12px;
  font-family:-apple-system, BlinkMacSystemFont,'Segoe UI', Roboto,'Noto Sans TC','Microsoft JhengHei',sans-serif;
}

html,body{ height:100%; margin:0; background:var(--bg);}
body{ padding:24px; display:flex; justify-content:center; }
.card{ width:100%; max-width:1300px; background:var(--card); border-radius:0; box-shadow:var(--shadow); overflow:hidden; display:flex; flex-direction:column; height:95vh;}
.header{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 20px; background:var(--primary); color:white; }
.title{ font-size:20px; font-weight:600; }
.search-row { display:flex; align-items:center; gap:12px; padding:12px 20px; background:#f9fafb; border-radius:8px; margin:0 16px 12px 16px; flex-wrap:wrap; }
.search-row .form-group{ display:flex; align-items:center; gap:6px; }
.search-row label{ font-size:15px; font-weight:500; color:var(--muted); white-space:nowrap; line-height:32px; }
.search-row input[type=date], .search-row select{ height:32px; padding:4px 8px; border-radius:6px; border:1px solid #ccc; font-size:14px; background:#fff; }
.btn-search{ height:32px; padding:0 14px; border-radius:6px; background:var(--primary-light); color:#fff; border:none; cursor:pointer; font-weight:600; font-size:14px; display:flex; align-items:center; justify-content:center; }
#countText{ padding:8px 20px; color:var(--muted); display:flex; justify-content:space-between; align-items:center; }
.list-wrapper{ flex:1; overflow-y:auto; }
.list{ width:100%; border-top:1px solid #eee; border-bottom:1px solid #eee; margin-top:0; }
.list-head{ display:flex; padding:10px 8px; align-items:center; color:var(--muted); font-weight:700; background:#f9fafb; position:sticky; top:0; z-index:2; }
.list-row{ display:flex; align-items:center; padding:12px 8px; border-bottom:1px solid #f2f2f2; }
.col-1{ flex:0 0 60px; text-align:center; color:var(--muted); }
.col-2{ flex:1; text-align:center; min-width:120px; }
.col-3{ flex:1; text-align:center; min-width:120px; }
.col-4{ flex:1; text-align:center; min-width:120px; }
.col-5{ flex:1; text-align:center; min-width:120px; }
.col-6{ flex:0 0 90px; text-align:center; }
.icon-btn{ padding:6px 8px; border-radius:8px; border:1px solid rgba(0,0,0,0.06); background:transparent; cursor:pointer; font-weight:600; }
.empty{ padding:28px; text-align:center; color:var(--muted); }
.modal-backdrop{ position:fixed; inset:0; background:rgba(2,6,23,0.45); display:none; align-items:center; justify-content:center; z-index:100; }
.modal{ background:var(--card); border-radius:var(--radius); padding:16px; max-width:900px; width:95%; box-shadow:var(--shadow); overflow:auto; display:flex; flex-direction:column; gap:12px; }
.modal-header{ padding-bottom:8px; border-bottom:1px solid #eee; font-size:18px; font-weight:600; color:#111; }
.modal-body{ display:flex; gap:12px; flex-wrap:wrap; }
.modal-footer{ display:flex; gap:8px; justify-content:flex-end; padding-top:12px; border-top:1px solid #eee; }
.btn-close{ height:32px; padding:0 16px; border-radius:6px; border:1px solid #ccc; background:#ffffff; color:#374151; font-weight:600; cursor:pointer; }
#topBtn{ position:fixed; right:20px; bottom:20px; width:44px; height:44px; background:var(--primary-light); color:white; border:none; border-radius:8px; display:none; align-items:center; justify-content:center; cursor:pointer; z-index:200; }
#topBtn:hover{ background:#0056b3; }
.details-summary{ cursor:pointer; font-weight:600; margin-bottom:4px; }
.districts span{ background:#f3f4f6; padding:2px 6px; border-radius:4px; margin-right:4px; margin-bottom:4px; display:inline-block; font-size:13px; }
.area-title{ font-weight:700; margin-top:8px; margin-bottom:4px; }
.pagination{ display:flex; gap:4px; flex-wrap:wrap; }
.pagination span{ cursor:pointer; padding:3px 5px; color:var(--primary); font-weight:600; font-size:12px; }
.pagination span.current{ font-weight:700; text-decoration:underline; cursor:default; color:#111; }
.pagination span.disabled{ color:#999; cursor:default; }
.pagination-container{ display:flex; justify-content:center; padding:8px 0; }
@media (max-width:720px){ .list-head{ font-size:13px; } .col-2,.col-3,.col-4,.col-5{ min-width:80px; } .search-row{ gap:8px; } }
</style>
</head>
<body>

<div class="card">
  <div class="header"><div class="title">事件紀錄</div></div>

  <div class="search-row">
    <div class="form-group"><label for="startDate">開始日期</label><input type="date" id="startDate"></div>
    <div class="form-group"><label for="endDate">結束日期</label><input type="date" id="endDate"></div>
    <div class="form-group"><label for="pageSizeSelect">每頁筆數</label>
      <select id="pageSizeSelect">
        <option>25</option>
        <option>50</option>
        <option>75</option>
        <option>100</option>
      </select>
    </div>
    <button class="btn-search" onclick="searchEvents()">搜尋</button>
  </div>

  <div id="countText">
    <div id="totalCount">共 0 筆資料</div>
    <div id="paginationTop" class="pagination"></div>
  </div>

  <div class="list-wrapper">
    <div class="list">
      <div class="list-head">
        <div class="col-1">序號</div>
        <div class="col-2">發生時間</div>
        <div class="col-3">芮氏規模</div>
        <div class="col-4">震央</div>
        <div class="col-5">深度(km)</div>
        <div class="col-6">瀏覽</div>
      </div>
      <div id="rowsContainer"><div class="empty">載入中...</div></div>
    </div>
  </div>
  <div class="pagination-container"><div id="paginationBottom" class="pagination"></div></div>
</div>

<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modal-header">事件瀏覽</div>
    <div class="modal-body" id="modalBody" style="display:flex; gap:12px; flex-wrap:nowrap;"></div>
    <div class="modal-footer">
      <button class="btn-close" onclick="closeModal()">關閉</button>
    </div>
  </div>
</div>

<button id="topBtn" onclick="scrollToTop()">TOP</button>

<script>
// ---------- 假資料 300筆 ----------
let events=[];
for(let i=1;i<=300;i++){
  const mag=(Math.random()*5+2).toFixed(1);
  const dt=new Date(2025,Math.floor(Math.random()*12),Math.floor(Math.random()*28)+1,Math.floor(Math.random()*24),Math.floor(Math.random()*60),Math.floor(Math.random()*60));
  const lat=22+Math.random()*3;
  const lon=120+Math.random()*2;
  const counties=['台北市','新北市','台中市','高雄市','台南市','花蓮縣'];
  const affected={};
  counties.forEach(c=>{affected[c]=['內湖區','大安區']});
  events.push({id:'E'+String(i).padStart(3,'0'), datetime:dt.toISOString(), magnitude:parseFloat(mag), epicenter:'縣市 '+i, depth:Math.floor(Math.random()*50), lat, lon, affected});
}
events.sort((a,b)=>new Date(b.datetime)-new Date(a.datetime));

const rowsContainer=document.getElementById('rowsContainer');
const totalCount=document.getElementById('totalCount');
const paginationTop=document.getElementById('paginationTop');
const paginationBottom=document.getElementById('paginationBottom');
const modalBackdrop=document.getElementById('modalBackdrop');
const modalBody=document.getElementById('modalBody');

let currentPage=1;
let pageSize=parseInt(document.getElementById('pageSizeSelect').value);
let filteredEvents=events.slice();

function render(list){
  rowsContainer.innerHTML='';
  if(!list||list.length===0){ 
    rowsContainer.innerHTML='<div class="empty">查無資料</div>'; 
    totalCount.textContent='共 0 筆資料';
    paginationTop.innerHTML='';
    paginationBottom.innerHTML='';
    return;
  }
  totalCount.textContent='共 '+list.length+' 筆資料';
  renderPagination(list.length);

  const start=(currentPage-1)*pageSize;
  const end=start+pageSize;
  const pageData=list.slice(start,end);

  pageData.forEach((e,idx)=>{
    const dt=new Date(e.datetime);
    const row=document.createElement('div'); 
    row.className='list-row';
    row.innerHTML=`
      <div class="col-1">${start+idx+1}</div>
      <div class="col-2">${formatDateTime(dt)}</div>
      <div class="col-3">${e.magnitude.toFixed(1)}</div>
      <div class="col-4">${escapeHtml(e.epicenter)}</div>
      <div class="col-5">${e.depth??'-'}</div>
      <div class="col-6"><button class="icon-btn" onclick="viewDetail('${e.id}')">瀏覽</button></div>
    `;
    rowsContainer.appendChild(row);
  });
}

function formatDateTime(d){
  const y=d.getFullYear();
  const m=String(d.getMonth()+1).padStart(2,'0');
  const day=String(d.getDate()).padStart(2,'0');
  const hh=String(d.getHours()).padStart(2,'0');
  const mm=String(d.getMinutes()).padStart(2,'0');
  const ss=String(d.getSeconds()).padStart(2,'0');
  return `${y}-${m}-${day} ${hh}:${mm}:${ss}`;
}
function escapeHtml(s){return String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;');}

document.getElementById('pageSizeSelect').addEventListener('change',()=>{
  pageSize=parseInt(document.getElementById('pageSizeSelect').value);
  currentPage=1;
  render(filteredEvents);
});

function searchEvents(){
  const startDate=document.getElementById('startDate').value;
  const endDate=document.getElementById('endDate').value;
  filteredEvents=events.slice();
  if(startDate) filteredEvents=filteredEvents.filter(e=>e.datetime.slice(0,10)>=startDate);
  if(endDate) filteredEvents=filteredEvents.filter(e=>e.datetime.slice(0,10)<=endDate);
  filteredEvents.sort((a,b)=>new Date(b.datetime)-new Date(a.datetime));
  currentPage=1;
  render(filteredEvents);
}

// -------- 分頁 --------
function renderPagination(total){
  const totalPages=Math.ceil(total/pageSize);
  const maxPageButtons=7;
  let pages=[];

  if(totalPages<=maxPageButtons){
    for(let i=1;i<=totalPages;i++) pages.push(i);
  }else{
    if(currentPage<=4){
      pages=[1,2,3,4,5,'...',totalPages];
    }else if(currentPage>=totalPages-3){
      pages=[1,'...',totalPages-4,totalPages-3,totalPages-2,totalPages-1,totalPages];
    }else{
      pages=[1,'...',currentPage-1,currentPage,currentPage+1,'...',totalPages];
    }
  }

  function createPageHTML(p){
    if(p===currentPage) return `<span class="current">${p}</span>`;
    return `<span onclick="goPage(${p})">${p}</span>`;
  }

  // 上方
  paginationTop.innerHTML='';
  paginationTop.innerHTML += `<span class="${currentPage===1?'disabled':''}" onclick="${currentPage===1?'':`goPage(1)` }">第一頁</span>`;
  pages.forEach(p=>{
    if(p==='...') paginationTop.innerHTML+=`<span>...</span>`;
    else paginationTop.innerHTML+=createPageHTML(p);
  });
  paginationTop.innerHTML += `<span class="${currentPage===totalPages?'disabled':''}" onclick="${currentPage===totalPages?'':`goPage(${totalPages})`}">最後一頁</span>`;

  // 下方
  paginationBottom.innerHTML='';
  paginationBottom.innerHTML += `<span class="${currentPage===1?'disabled':''}" onclick="${currentPage===1?'':`goPage(${currentPage-1>0?currentPage-1:1})`}">上一頁</span>`;
  pages.forEach(p=>{
    if(p==='...') paginationBottom.innerHTML+=`<span>...</span>`;
    else paginationBottom.innerHTML+=createPageHTML(p);
  });
  paginationBottom.innerHTML += `<span class="${currentPage===totalPages?'disabled':''}" onclick="${currentPage===totalPages?'':`goPage(${currentPage+1<=totalPages?currentPage+1:totalPages})`}">下一頁</span>`;
}

function goPage(p){
  const totalPages=Math.ceil(filteredEvents.length/pageSize);
  if(p<1) p=1;
  if(p>totalPages) p=totalPages;
  currentPage=p;
  render(filteredEvents);
}

// -------- Modal 瀏覽內容保持不變 --------
function viewDetail(id){
  const e = events.find(x=>x.id===id);
  if(!e) return alert('找不到事件資料');
  modalBody.innerHTML='';

  const leftDiv=document.createElement('div');
  leftDiv.style.flex='1'; leftDiv.style.minWidth='300px';
  leftDiv.style.display='flex';
  leftDiv.style.flexDirection='column';
  leftDiv.style.gap='8px';

  const infoDiv=document.createElement('div');
  infoDiv.innerHTML=`
    <div style="font-weight:700;">事件 ${escapeHtml(e.id)} - ${formatDateTime(new Date(e.datetime))}</div>
    <p>芮氏規模：<strong>${e.magnitude.toFixed(1)}</strong></p>
    <p>震央：${escapeHtml(e.epicenter)}（緯度 ${e.lat??'-'}，經度 ${e.lon??'-'}）</p>
    <p>深度：${e.depth??'-'} km</p>
  `;
  leftDiv.appendChild(infoDiv);

  const regionOrder = { '北部':[], '中部':[], '南部':[], '東部':[] };
  const north=['台北市','新北市','基隆市','桃園市','新竹市','新竹縣','宜蘭縣'];
  const central=['台中市','彰化縣','南投縣','雲林縣','苗栗縣','嘉義市','嘉義縣'];
  const south=['高雄市','台南市','屏東縣','澎湖縣','金門縣','連江縣'];
  const east=['花蓮縣','台東縣'];
  for(const county of Object.keys(e.affected||{})){
    if(north.includes(county)) regionOrder['北部'].push(county);
    else if(central.includes(county)) regionOrder['中部'].push(county);
    else if(south.includes(county)) regionOrder['南部'].push(county);
    else if(east.includes(county)) regionOrder['東部'].push(county);
  }

  const affectedDiv=document.createElement('div');
  affectedDiv.style.width='100%';
  for(const region of Object.keys(regionOrder)){
    const counties = regionOrder[region];
    if(counties.length===0) continue;
    const regionTitle=document.createElement('div');
    regionTitle.className='area-title';
    regionTitle.textContent=region;
    affectedDiv.appendChild(regionTitle);
    counties.forEach(county=>{
      const details=document.createElement('details');
      details.open=true;
      const summary=document.createElement('summary');
      summary.className='details-summary';
      summary.textContent=`${county} 最大震度 ${e.magnitude.toFixed(1)} 級`;
      details.appendChild(summary);
      const townsDiv=document.createElement('div');
      townsDiv.className='districts';
      (e.affected[county]||[]).forEach(town=>{
        const span=document.createElement('span');
        span.textContent=`${town} ${e.magnitude.toFixed(1)} 級`;
        townsDiv.appendChild(span);
      });
      details.appendChild(townsDiv);
      affectedDiv.appendChild(details);
    });
  }
  leftDiv.appendChild(affectedDiv);

  const rightDiv=document.createElement('div');
  rightDiv.style.width='400px';
  rightDiv.style.height='300px';
  rightDiv.style.border='1px solid #ccc';
  rightDiv.style.borderRadius='8px';
  rightDiv.style.overflow='hidden';
  rightDiv.innerHTML=`<img style="width:100%;height:100%;object-fit:cover;"
    src="https://maps.googleapis.com/maps/api/staticmap?center=${e.lat},${e.lon}&zoom=7&size=400x300&markers=color:red%7C${e.lat},${e.lon}&key=YOUR_API_KEY">`;

  modalBody.style.display='flex';
  modalBody.appendChild(leftDiv);
  modalBody.appendChild(rightDiv);

  openModal();
}

function openModal(){ modalBackdrop.style.display='flex'; }
function closeModal(){ modalBackdrop.style.display='none'; }
modalBackdrop.addEventListener('click', ev=>{ if(ev.target===modalBackdrop) closeModal(); });

function scrollToTop(){ window.scrollTo({top:0,behavior:'smooth'}); }
window.addEventListener('scroll',()=>{ document.getElementById('topBtn').style.display=(window.scrollY>300)?'flex':'none'; });

render(filteredEvents);
</script>
</body>
</html>

